<?xml version="1.0" encoding="UTF-8"?>
<definitions id="definitions" 
  xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:activiti="http://activiti.org/bpmn"
  targetNamespace="http://activiti.org/bpmn20">
  
  <process id="giftCardsProcess" name="彩金卡申请操作流程">
  	 <startEvent id="theStart" />
     <sequenceFlow id="flow1" sourceRef="theStart" targetRef="createGiftCardsTask" />
    
     <serviceTask id="createGiftCardsTask" name="创建彩金卡申请工单" 
       activiti:delegateExpression="${createGiftCardsTaskDelegate}" />    
     <sequenceFlow id="flow2" sourceRef="createGiftCardsTask" targetRef="cooHandleGiftCardsTask" />
     
     <userTask id="cooHandleGiftCardsTask" name="总监处理彩金卡申请工单">
    	<extensionElements>
		    <activiti:taskListener delegateExpression="${processTaskListener}" event="create"/>
		</extensionElements>
     </userTask>
     <sequenceFlow id="flow3" sourceRef="cooHandleGiftCardsTask" targetRef="cooAgreeGw" />
     
      <!-- start 总监是否通过 -->
     <exclusiveGateway id="cooAgreeGw" name="总监是否通过判断" /> 
     <sequenceFlow id="endFlow7" sourceRef="cooAgreeGw" targetRef="theEnd">
	     <documentation>
	     	总监未通过
	     </documentation>
     	<conditionExpression xsi:type="tFormalExpression">${!agree}</conditionExpression>
     </sequenceFlow>
     <sequenceFlow id="endFlow8" sourceRef="cooAgreeGw" targetRef="cooAmountGw">
     	 <documentation>
	     	总监已通过
	     </documentation>
     	<conditionExpression xsi:type="tFormalExpression">${agree}</conditionExpression>
     </sequenceFlow>
     <!-- end 总监是否通过 -->
     
     <!-- start 总监额度判断 -->
     <exclusiveGateway id="cooAmountGw" name="总监额度判断" /> 
     <sequenceFlow id="endFlow1" sourceRef="cooAmountGw" targetRef="ceoHandleGiftCardsTask">
	     <documentation>
	     	额度不足，等待ceo处理
	     </documentation>
     	<conditionExpression xsi:type="tFormalExpression">${!enough}</conditionExpression>
     </sequenceFlow>
     <sequenceFlow id="endFlow2" sourceRef="cooAmountGw" targetRef="executeGiftCards">
     	 <documentation>
	     	额度充足，批准彩金卡申请
	     </documentation>
     	<conditionExpression xsi:type="tFormalExpression">${enough}</conditionExpression>
     </sequenceFlow>
     <!-- end 总监额度判断 -->
     
     <userTask id="ceoHandleGiftCardsTask" name="ceo处理彩金卡申请工单">
    	<extensionElements>
		    <activiti:taskListener delegateExpression="${processTaskListener}" event="create"/>
		</extensionElements>
     </userTask>
     <sequenceFlow id="flow4" sourceRef="ceoHandleGiftCardsTask" targetRef="ceoAgreeGw" />
     
      <!-- start ceo是否通过 -->
     <exclusiveGateway id="ceoAgreeGw" name="ceo是否通过判断" /> 
     <sequenceFlow id="endFlow11" sourceRef="ceoAgreeGw" targetRef="theEnd">
	     <documentation>
	     	ceo未通过
	     </documentation>
     	<conditionExpression xsi:type="tFormalExpression">${!agree}</conditionExpression>
     </sequenceFlow>
     <sequenceFlow id="endFlow12" sourceRef="ceoAgreeGw" targetRef="executeGiftCards">
     	 <documentation>
	     	ceo已通过
	     </documentation>
     	<conditionExpression xsi:type="tFormalExpression">${agree}</conditionExpression>
     </sequenceFlow>
     <!-- end ceo是否通过 -->
     
    <serviceTask id="executeGiftCards" name="生成彩金卡" 
       activiti:delegateExpression="${executeGiftCardsDelegate}" />
     <sequenceFlow id="flow9" sourceRef="executeGiftCards" targetRef="theEnd" />
     
     <endEvent id="theEnd" />
  </process>
  
</definitions>